{{template "base" .}}

{{define "title"}}{{.Account.Name}} // LORE{{end}}

{{define "content"}}
<div class="account-header">
    <div class="account-info">
        <h1 class="account-name">{{.Account.Name}}</h1>
        <div class="account-id">{{.Account.ID}}</div>
    </div>
    <div class="account-badges">
        {{if .Account.TrustRating}}
        <div class="rating-badge grade-{{if ge .Account.TrustRating.Score 3.0}}a{{else if ge .Account.TrustRating.Score 2.0}}b{{else if ge .Account.TrustRating.Score 1.5}}c{{else}}d{{end}}">
            <div class="rating-grade">{{.Account.TrustRating.Grade}}</div>
            <div class="rating-details">
                <div class="rating-label">Trust Rating</div>
                <div class="rating-counts">
                    <span class="rc-a">A:{{.Account.TrustRating.CountA}}</span>
                    <span class="rc-b">B:{{.Account.TrustRating.CountB}}</span>
                    <span class="rc-c">C:{{.Account.TrustRating.CountC}}</span>
                    <span class="rc-d">D:{{.Account.TrustRating.CountD}}</span>
                </div>
            </div>
        </div>
        {{end}}
        {{if .Account.IsCorporate}}
        <div class="value-badge">
            <div class="value-amount">{{formatNumber .Account.TotalXLMValue}}</div>
            <div class="value-label">XLM Value</div>
        </div>
        {{end}}
    </div>
</div>

<div class="detail-grid">
    {{if .Account.About}}
    <div class="detail-block">
        <div class="detail-block-title">About</div>
        <div class="detail-block-content">{{.Account.About}}</div>
    </div>
    {{end}}

    {{if .Account.Websites}}
    <div class="detail-block">
        <div class="detail-block-title">Links</div>
        <div class="detail-block-content">
            <ul class="links-list">
                {{range .Account.Websites}}
                <li><a href="{{.}}" target="_blank" rel="noopener">{{.}}</a></li>
                {{end}}
            </ul>
        </div>
    </div>
    {{end}}
</div>

{{if .Account.Categories}}
<div class="connections-section">
    <div class="connections-header">Connections</div>
    {{range $idx, $cat := .Account.Categories}}
    <details class="category{{if $cat.IsEmpty}} empty{{end}}">
        <summary>
            <span class="category-name" style="color: {{$cat.Color}}">{{$cat.Name}}</span>
            <span class="category-count">({{len $cat.Relationships}})</span>
            {{if $cat.IsEmpty}}<span class="category-empty-badge">empty</span>{{end}}
        </summary>
        {{if not $cat.IsEmpty}}
        <div class="category-content">
            {{$catName := $cat.Name}}
            {{$count := len $cat.Relationships}}
            <input type="checkbox" id="toggle-{{$cat.Name}}" class="show-all-toggle">
            <div class="relationships-grid">
                {{range $cat.Relationships}}
                <div class="relationship-row">
                    <span class="relationship-arrow {{.Direction}}">{{relationArrow .Direction}}</span>
                    <span class="relationship-type cat-{{if eq $catName "FAMILY"}}family{{else if eq $catName "WORK"}}work{{else if eq $catName "NETWORK"}}network{{else if eq $catName "OWNERSHIP"}}ownership{{else}}social{{end}}">{{.Type}}</span>
                    <a href="/accounts/{{.TargetID}}" class="relationship-name">{{.TargetName}}</a>
                    <span class="relationship-id">{{truncateID .TargetID}}</span>
                    <span class="relationship-badge-slot">{{if .IsMutual}}<span class="relationship-badge mutual">mutual</span>{{else if .IsConfirmed}}<span class="relationship-badge confirmed">confirmed</span>{{end}}</span>
                </div>
                {{end}}
            </div>
            {{if gt $count 10}}
            <label for="toggle-{{$cat.Name}}" class="show-all-btn">
                <span class="show-more">Show all {{$count}} connections</span>
                <span class="show-less">Show less</span>
            </label>
            {{end}}
        </div>
        {{end}}
    </details>
    {{end}}
</div>
{{end}}

<div class="detail-grid">
    <div class="detail-block full-width">
        <div class="detail-block-title">Tokens ({{len .Account.Trustlines}})</div>
        {{if .Account.Trustlines}}
        {{$tokenCount := len .Account.Trustlines}}
        <input type="checkbox" id="toggle-tokens" class="show-all-toggle">
        <div class="trustlines">
            <table class="trustlines-table">
                <thead>
                    <tr>
                        <th>Asset</th>
                        <th>Balance</th>
                    </tr>
                </thead>
                <tbody class="tokens-body">
                    {{range .Account.Trustlines}}
                    <tr>
                        <td>{{.AssetCode}}</td>
                        <td>{{.Balance}}</td>
                    </tr>
                    {{end}}
                </tbody>
            </table>
        </div>
        {{if gt $tokenCount 10}}
        <label for="toggle-tokens" class="show-all-btn tokens-toggle">
            <span class="show-more">Show all {{$tokenCount}} tokens</span>
            <span class="show-less">Show less</span>
        </label>
        {{end}}
        {{else}}
        <div class="empty">NO TOKENS</div>
        {{end}}
    </div>
</div>

{{if .Operations}}
{{$names := .AccountNames}}
<div id="operations" class="section ops-section">
    <div class="section-header">
        <span class="section-title">Operations</span>
        <span class="section-count">Newest first</span>
    </div>

    <div class="ops-list">
        {{range .Operations.Operations}}
        <a href="/transactions/{{.TransactionHash}}#operations" class="op-row">
            <span class="op-time">{{.CreatedAt}}</span>
            <span class="op-type op-{{.TypeCategory}}">{{.TypeDisplay}}</span>
            <span class="op-summary">
                {{if eq .Type "payment"}}
                    {{if .Amount}}{{.Amount}} {{.AssetCode}}{{end}}
                    {{if .To}}→ <span class="op-account-link">{{accountDisplay .To $names}}</span>{{end}}
                {{else if eq .Type "create_account"}}
                    {{.StartingBalance}} XLM → <span class="op-account-link">{{accountDisplay .To $names}}</span>
                {{else if eq .Type "change_trust"}}
                    {{.AssetCode}}{{if eq .TrustLimit "0"}} (remove){{end}}
                {{else if eq .Type "manage_data"}}
                    {{if .DataValue}}{{.DataName}} = {{if isStellarID .DataValue}}<span class="op-account-link">{{accountDisplay .DataValue $names}}</span>{{else}}"{{.DataValue}}"{{end}}{{else}}deleted {{.DataName}}{{end}}
                {{else if or (eq .Type "path_payment_strict_send") (eq .Type "path_payment_strict_receive")}}
                    {{.SourceAmount}} {{.SourceAsset}} → {{.DestAmount}} {{.DestAsset}}
                {{else if or (eq .Type "manage_sell_offer") (eq .Type "manage_buy_offer")}}
                    {{if .Amount}}{{.Amount}} {{end}}{{.Selling}} → {{.Buying}}{{if .Price}} @ {{.Price}}{{end}}
                {{else if eq .Type "account_merge"}}
                    → <span class="op-account-link">{{accountDisplay .To $names}}</span>
                {{else}}
                    {{.TypeDisplay}}
                {{end}}
            </span>
            <span class="op-arrow">▶</span>
        </a>
        {{end}}
    </div>

    {{if .Operations.HasMore}}
    <div class="pagination">
        <a href="/accounts/{{.Account.ID}}?ops_cursor={{.Operations.NextCursor}}#operations" class="btn">Load More</a>
    </div>
    {{end}}
</div>
{{end}}
{{end}}
